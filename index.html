<!DOCTYPE html>
<html>
<head>
    <title>GitHub Global Mesh</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <style>
        body { margin: 0; background: #111; color: #00ff00; font-family: sans-serif; overflow: hidden; }
        #status { position: fixed; top: 10px; left: 10px; padding: 10px; background: rgba(0,0,0,0.8); border: 1px solid #00ff00; z-index: 100; }
        .player { 
            position: absolute; width: 30px; height: 30px; 
            border: 2px solid #00ff00; border-radius: 50%;
            transition: transform 0.1s linear; pointer-events: none;
            display: flex; align-items: center; justify-content: center; font-size: 8px;
        }
        #me { background: #fff; box-shadow: 0 0 15px #fff; border-color: #fff; }
    </style>
</head>
<body>

    <div id="status">
        <b>Status:</b> <span id="state">Connecting to Mesh...</span><br>
        <b>Online Now:</b> <span id="count">1</span>
    </div>

    <div id="world">
        <div id="me" class="player">ME</div>
    </div>

    <script>
        // 1. Initialize Gun with public relay peers
        const gun = Gun([
            'https://gun-manhattan.herokuapp.com/gun',
            'https://peer.wall.org/gun'
        ]);
        
        const myID = "user_" + Math.floor(Math.random() * 100000);
        const playerMap = {};
        const world = document.getElementById('world');
        const lobby = gun.get('global-github-lobby-2026');

        // 2. Track Mouse Movement
        window.addEventListener('mousemove', (e) => {
            const x = e.clientX - 15;
            const y = e.clientY - 15;
            
            // Move local player
            document.getElementById('me').style.transform = `translate(${x}px, ${y}px)`;

            // Send to GitHub Global Mesh
            lobby.get(myID).put({ x: x, y: y, time: Date.now() });
        });

        // 3. Listen for Everyone Else
        lobby.map().on((data, id) => {
            if (!data || id === myID) return;

            // Remove players inactive for more than 5 seconds
            if (Date.now() - data.time > 5000) {
                if (playerMap[id]) {
                    playerMap[id].remove();
                    delete playerMap[id];
                }
                return;
            }

            // Create remote player if they don't exist
            if (!playerMap[id]) {
                const p = document.createElement('div');
                p.className = 'player';
                p.innerText = "PLAYER";
                world.appendChild(p);
                playerMap[id] = p;
            }

            // Update remote position
            playerMap[id].style.transform = `translate(${data.x}px, ${data.y}px)`;
            
            // Update UI
            document.getElementById('state').innerText = "CONNECTED";
            document.getElementById('count').innerText = Object.keys(playerMap).length + 1;
        });
    </script>
</body>
</html>
